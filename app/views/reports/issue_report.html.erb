<h2><%=l(:label_report_plural)%></h2>
<%= render_tabs issue_report_tabs %>
<div class="splitcontent">
<!-- <div class="splitcontentleft"> -->
  <h3>
    <%=l("field_#{@result[:detail]}")%>&nbsp;
    <%= link_to l(:label_details),
          project_issues_report_details_path(@project, :detail => @result[:detail]),
          :class => 'icon-only icon-zoom-in',
          :title => l(:label_details) %>
  </h3>
  <%= render :partial => 'simple', :locals => { :data => @result[:data], :field_name => @result[:field_name], :rows => @result[:rows] } %>
  <br />

<!-- </div> -->
  <% other_formats_links do |f| %>
    <%= f.link_to_with_query_parameters 'CSV', {}, :onclick => "showModal('csv-export-options', '330px'); return false;" %>
    <%= f.link_to_with_query_parameters 'PDF' %>
    <span></span>
    <%= link_to "EMAIL", "#", :onclick => "showModal('select-attachment-modal', '350px'); return false;" %>

  <% end %>
  <div id="csv-export-options" style="display: none;">
    <h3 class="title"><%= l(:label_export_options, :export_format => 'CSV') %></h3>
    <%= form_tag(project_issues_report_path(@project, :format => 'csv'), :method => :get, :id => 'csv-export-form') do %>
    <%= hidden_field_tag :tab, @result[:detail] %>
    <%= export_csv_encoding_select_tag %>
    <%= export_csv_separator_select_tag %>
    <p class="buttons">
      <%= submit_tag l(:button_export), :name => nil, :onclick => 'hideModal(this);', :data => {:disable_with => false} %>
      <%= link_to_function l(:button_cancel), 'hideModal(this);' %>
    </p>
    <% end %>
  </div>
  <div id="select-attachment-modal" style="display:none;">
    <h3 class="title">Select attachment file</h3>
    <%= form_tag(project_issues_report_path(@project, :format => 'pdf'), :method => :get, :id => 'select-attachment-form') do %>
      <%= hidden_field_tag 'email_with_attachment', true %>
      <p>
        <label for="user">Email To:</label><br>
        <%= select_tag 'users[]', options_from_collection_for_select(User.order(:firstname), 'id', 'name', User.current.id), multiple: true, size: 10, class: 'select2', style: 'width: 309px;' %>
      </p>
      <p>
        <label for="subject">Subject:</label>
        <%= text_field_tag 'subject', "#{User.current.name} share you list", style: 'width: 262px;' %>
      </p>
      <p>
        <label for="message">Message:</label><br>
        <%= text_area_tag 'message', '', rows: 4, cols: 40 %>
      </p>
      <p>
        <label><%= radio_button_tag 'attachment_type', 'pdf', true, class: "pdf-selection" %>PDF</label><br />
        <label>
          <%= radio_button_tag 'attachment_type', 'csv', false, class: "csv-selection" %>
          CSV
        </label>
        <br />
      </p>
      <div id="csv-options" style="display:none;">
        <h3 class="title"><%= l(:label_export_options, :export_format => 'CSV') %></h3>
        <%= hidden_field_tag :tab, @result[:detail] %>
        <%= export_csv_encoding_select_tag %>
        <%= export_csv_separator_select_tag %>
      </div>
      <p class="buttons">
        <%= submit_tag "Send Email", :name => nil, :onclick => "hideModal(this);", :data => { :disable_with => false } %>
        <%= link_to_function l(:button_cancel), "hideModal(this);" %>
      </p>
    <% end %>
  </div>
</div>

<%= stylesheet_link_tag "https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" %>
<%= javascript_include_tag "https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js" %>
<script>
  $(document).ready(function() {
    $('.csv-selection').click(function() {
      $('#csv-options').show();
    });
    $('.pdf-selection').click(function() {
      $('#csv-options').hide();
    });
  });

  $('.select2').select2();
</script>
<style>
  .select2-selection__choice__remove {
    height: 14px !important;
  }
  
  #content .tabs ul li a.selected {
    color: #169;
  }
  #content .tabs ul li a {
    font-size: 1.6em;
  }
  #content .tabs {
    height: 3.0em;
  }
  button.tab-left, button.tab-right {
    height: 39px;
  }

  p.other-formats {
    margin-left: auto;
  }
</style>